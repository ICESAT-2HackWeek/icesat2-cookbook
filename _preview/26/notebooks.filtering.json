{"version":2,"kind":"Notebook","sha256":"dee0f01b40c5db367ff2fe19cde9922da992ce76296e4efc4a683acc4363559d","slug":"notebooks.filtering","location":"/notebooks/filtering.ipynb","dependencies":[],"frontmatter":{"title":"Cloud effects on ICESat-2 data,  and Data Filtering","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"ICESat-2 team","given":"ICESat-2","family":"team"},"name":"ICESat-2 team","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/ICESAT-2HackWeek/icesat2-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/ICESAT-2HackWeek/icesat2-cookbook/blob/HEAD/notebooks/filtering.ipynb","edit_url":"https://github.com/ICESAT-2HackWeek/icesat2-cookbook/edit/HEAD/notebooks/filtering.ipynb","thumbnail":"/icesat2-cookbook/_preview/26/build/ATL06_segment_model-6ff033e2c9b30efdf56e5e0b1fe82616.png","exports":[{"format":"ipynb","filename":"filtering.ipynb","url":"/icesat2-cookbook/_preview/26/build/filtering-6e240df6b160d2e97e0dd4ba21c4a51e.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LyxRQvxiFG"}],"key":"EdpwtdEiaW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oJoUY6009b"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"pKDk81sppH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ICESat-2 land-ice product (ATL06) was designed to measure the heights of snow and ice surfaces.  But when we’re making these measurements, sometimes clouds get in the way, and the measured heights aren’t as precise or accurate as we would like. This tutorial covers some of the reasons you might see weird results over ice when clouds start to blot out the surface signals.  The learning objectives I’d like to get to are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VCzPxxnnVK"}],"key":"tZcyspElF3"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Understanding how clouds affect laser-altimetry signals","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"D9oLyxX0Os"}],"key":"ti3mUDxrfm"}],"key":"FRMbAOcD8x"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Recognizing how these effects are manifest in the ATL06 product","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xSIVlCPyuK"}],"key":"JUbdnMyGJj"}],"key":"NjnYvyCSS4"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Gaining familiarity with the ATL06 parameters that can identify cloudy returns","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"iM23r3fzUq"}],"key":"Ppaft91fj0"}],"key":"IysxAso3s6"}],"key":"xEOZEwRYoA"}],"key":"MULXHD3El2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nUpYZBFwtq"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"tlrjksBsKs"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bUDpR1H33e"}],"key":"gw4cHeKUbP"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nh0HtfPaHj"}],"key":"ouJO9HXQwQ"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QKwhTfcG2y"}],"key":"FLvDL3G7EX"}],"key":"WuqPaTGyOH"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/pandas/pandas","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"pandas","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"u60oz1yHNB"}],"urlSource":"https://foundations.projectpythia.org/core/pandas/pandas","key":"Xq5sYAmBRG"}],"key":"e1hCg53MOK"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xKYsty7MFJ"}],"key":"NC0TmJisPv"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ICESat-2 data in this tutorial will appear as geopandas dataframes","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"t4fgUX7mep"}],"key":"h8RSxrEEDo"}],"key":"P4hj5by3rL"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/matplotlib","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"numpy/matplotlib","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ziv2URHiY9"}],"urlSource":"https://foundations.projectpythia.org/core/matplotlib","key":"MMyveKyY1n"}],"key":"HOQJTA4BNP"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"t5LPO6vc0e"}],"key":"e8mQpk2LcK"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We will do our plotting with matplotlib","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JL8Jq6LqEz"}],"key":"tgoPx8fd0C"}],"key":"PBodAsVZbC"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"/notebooks/mission-overview","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"ICESat-2 Mission Overview","key":"Q487k0Fe2a"}],"urlSource":"mission-overview.ipynb","dataUrl":"/notebooks.mission-overview.json","internal":true,"protocol":"file","key":"BsMtrDATBb"}],"key":"VVcpTKyHQW"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"X42lYV63aU"}],"key":"h2vXgxNUz1"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Here is where to go to understand the ICESat-2 mission and its goals","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nR7lJNWYmr"}],"key":"Ox3HRqIvYX"}],"key":"QWZ6ej5S1R"}],"key":"PTe1iXqY41"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"UDEMN2Wze1"}],"key":"i6iEWXIYJh"},{"type":"text","value":":  30 min.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"P1UUpXsyPI"}],"key":"Isyv5GXkgu"}],"key":"BB0MP1VTrD"}],"key":"EkEWBYjJmO"}],"key":"yE902QFwEQ"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"UB0smv6Swb"}],"key":"CmnWlDAtYx"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This tutorial was developed on CryoCloud under the default environment.  If you’re using CryoCloud, you’ll need to pick an instance that uses at least 7 GB of memory to keep the kernel from running out of memory and resetting.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"D8sIQEp3Ui"}],"key":"YuRW43oxWj"}],"key":"Lr1g0EXjEv"}],"key":"dux1xyOUij"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vBIWdt8NvP"}],"key":"rEo2aX3muv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aJYXjSiLjN"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"KNB2qrV2yY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We’ll use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wxax0KIju9"},{"type":"link","url":"https://slideruleearth.io","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SlideRule","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Aaf7Jrdy03"}],"urlSource":"https://slideruleearth.io","key":"TT3EzAQ9eB"},{"type":"text","value":" computational platfrom to access ATL06 segments and ATL03 photons, and will use an image of the ice shelf from the REMA project to visualize the location.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pSuJcVd5DL"}],"key":"phROnVdlU6"}],"key":"UvNwyb3BnI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# General packages for the tutorial\nimport pprint\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport geopandas as gpd\n%matplotlib widget\n\n# packages needed for the basemap \nimport PIL.Image\nimport urllib.request\nimport urllib.parse\n\n#sliderule\nfrom sliderule import icesat2\nimport sliderule\n# We'll initialize sliderule with the verbosity flag set to 'False.'  If you like to see lots of text scrolling by, set it to 'True'\nicesat2.init(\"slideruleearth.io\", False)","key":"LPStWvr9YI"},{"type":"output","id":"6rV3UcEerhpXv_EeHRSTa","data":[],"key":"aoqhnPsUhj"}],"key":"BG4uicbl7k"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Background: ATL06 signal processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yPRopWPpsV"}],"identifier":"background-atl06-signal-processing","label":"Background: ATL06 signal processing","html_id":"background-atl06-signal-processing","implicit":true,"key":"o0BKtXINy8"},{"type":"image","url":"/icesat2-cookbook/_preview/26/build/ATL06_segment_model-6ff033e2c9b30efdf56e5e0b1fe82616.png","alt":"ATL06 segment model","width":600,"height":600,"key":"s06743HwQw","urlSource":"assets/filtering/ATL06_segment_model.png"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Recall that ATL06 gives us surface heights based on the heights of collections of photons in a 40-m (horizontal) by w_surface_window (vertical) window.  It uses a variety of techniques to shrink the window to the smallest size that contains the surface without clipping off any signal photons.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ev32MfVbPS"}],"key":"Bd8McgHrcn"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"There’s a general philosophy that went into the design of ATL06:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"h0K9gp7fDP"}],"key":"kFGfZyInaP"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use the best available information to identiy the surface","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jV3O8BIgZj"}],"key":"eT0QIYjiZw"}],"key":"OjNKs4BkYU"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If there’s a chance that we’ve found a weak surface return, report it","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"FNYTfBGCSX"}],"key":"mOB9sjpqli"}],"key":"iSRvHKtGId"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Provide enough parameters that users can decide which returns are worth using, and which are not","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"nd28pgMpjt"}],"key":"wSa1xePmpY"}],"key":"oG5QJMR7Bv"}],"key":"u0UPKzEtwm"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"When there are no thick clouds between ICESat-2 and the surface, finding the surface return and reporting its height is straightforward: ATL03 provides a tight cluster of high-confidence photons, and ATL06 calculates a weighted average of their heights.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"mGKXB6xZVU"}],"key":"OqzzBqLE9D"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Once clouds start to block some of the laser light, the number of photons that return to ATLAS from each return becomes progressively smaller.  Unfortunately, even if there are no laser photons to measure, during daylight there is no shortage of other photons to track, which come primarily from sunlight reflecting ground and from clouds.  ATLAS does a very good job of filtering out almost all of these photons, but on a sunny day, over a white surface, the measured background rate can be as high as 12 MHz.  Converting to dimensions that we’ll be seeing this is:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"gdAeWKsbR5"}],"key":"FYP8cGHaMZ"},{"type":"math","value":"\\frac{1.2\\times10^7 photons}{second} \\times \\frac{1 second}{1.5\\times10^8 m} = \\frac{1 photon}{12.5 m}","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"tight":true,"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mrow><mn>1.2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup><mi>p</mi><mi>h</mi><mi>o</mi><mi>t</mi><mi>o</mi><mi>n</mi><mi>s</mi></mrow><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi></mrow></mfrac><mo>×</mo><mfrac><mrow><mn>1</mn><mi>s</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi></mrow><mrow><mn>1.5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup><mi>m</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mn>1</mn><mi>p</mi><mi>h</mi><mi>o</mi><mi>t</mi><mi>o</mi><mi>n</mi></mrow><mrow><mn>12.5</mn><mi>m</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{1.2\\times10^7 photons}{second} \\times \\frac{1 second}{1.5\\times10^8 m} = \\frac{1 photon}{12.5 m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.1771em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4911em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">seco</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1.2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1408em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1.5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mord mathnormal\">seco</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">12.5</span><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"1","key":"EKbXURKWV7"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"This doesn’t sound like a lot, but over a 10-meter-high window that’s 40 m long (typical for the kind of windows you might use to look for the surface if you didn’t know where to find it) we can expect to find 45 photons.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BG6DN8nCTD"}],"key":"wuJs8elbAR"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Unlike surface-return photons, background photons are uniformally distributed in height, and any clustering of these photons will be due to random chance.  When the signal quality is marginal, ATL03 may flag photons only as low- and medium- confidence for a particular segment, or may flag no photons at all.  If ATL03 hasn’t told ATL06 which photons are the surface, the algorithm uses a backup signal-finding strategy that initializes surface finding using the strongest cluster of photons available.  It then attempts to converge its surface window on a tight cluster of photons.  This occasionally works, but if there really is no signal, the size of the window generally remains large, and we can evaluate the results based on the signal-to-noise ratio (SNR) of whatever ends up inside the window.  Only those segments with at least 10 photons, for which the probability of converging to an SNR equal to the observed SNR or better for random-noise inputs is less thatn 5% are reported.  This cuts down on false positives considerably.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"PP3n1DR1Kk"}],"key":"qyxXxPV1WW"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Let’s take a look at some data from Antarctica to see what different problematic data might look like.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Mu9Ute3xi0"}],"key":"oAz04YDlU6"}],"key":"RawLNUP9Sg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geographic Setting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gPJKVrcOT0"}],"identifier":"geographic-setting","label":"Geographic Setting","html_id":"geographic-setting","implicit":true,"key":"VkB7yYtQzy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We’ll be working on Cook Ice Shelf, a heavily crevassed and rifted ice shelf that drains East Antarctica.  I’ve defined a polygon that covers the transition between grounded ice (at the top) floating ice (within the polygon).  The region we’ll be working in is about 70 km x 60 km, and is covered by 20-30 ICESat-2 repeat tracks.  We can get an image of the shelf from the ArcticDEM project, using a urllib-based request.  Note: This code can be used to obtain a basic image for almost anywhere in the Arctic and Antarctic, which might be helpful in other work.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YQvxBC5Tya"}],"key":"kxLjJv2Vrz"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The location information is stored in a kml file in the assets directory, but you can substitute your own kml if you’d like to look at data from somewhere else.  Just make sure not to make your query too large to avoid running out of memory.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aqsZ5LSJwy"}],"key":"sY04TZgRs4"}],"key":"nZCrWiwfFy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# read in a polygon defining our area of interest:\ndf = gpd.read_file('assets/filtering/Cook_subset.kml')\ngeom_xy = df.to_crs(3031).geometry[0]\ngeom_ll = df.geometry[0]\n\n# get a shaded relief DEM to use as a basemap. This uses the ArcticDEM image server.\n\nHOST = 'https://elevation2.arcgis.com/arcgis/rest/services/Polar/AntarcticDEM/ImageServer/exportImage?'\nparams = []\nparams.append('bboxSR=3031')\nparams.append('imageSR=3031')\nparams.append('format=jpgpng')\nparams.append('noDataInterpretation=esriNoDataMatchAll')\nparams.append('f=image')\n\n[xmin, xmax], [ymin, ymax] = np.array(geom_xy.bounds).reshape(2,2).T\n# include a little bit more area at the top:\nymax += 2.e4 \nbbox = f'{xmin},{ymin},{xmax},{ymax}'\nparams.append(f'bbox={urllib.parse.quote(bbox)}')\n\nimage_service_url = HOST + '&'.join(params)\nshaded_relief_img = {'data': np.array(PIL.Image.open(urllib.request.urlopen(image_service_url))),\n    'extent':[xmin, xmax, ymin, ymax]}\nplt.figure()\nplt.imshow(shaded_relief_img['data'], extent=shaded_relief_img['extent'])\nx_poly, y_poly, _ = [*np.c_[geom_xy.exterior.coords].T]\nplt.plot(x_poly, y_poly,'r')\n\nplt.gca().set_xlabel('polar-stereographic E, m')\nplt.gca().set_xlabel('polar-stereographic N, m')","key":"QZ3ASxxAqZ"},{"type":"output","id":"g9TQEqlBdXZZLSLr-8xM1","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1f0e88c5dc72667b99a716ca36dc5c2f","path":"/icesat2-cookbook/_preview/26/build/1f0e88c5dc72667b99a716ca36dc5c2f.png"},"text/html":{"content_type":"text/html","hash":"289641847335f7c73e6b7b9eb2712c12","path":"/icesat2-cookbook/_preview/26/build/289641847335f7c73e6b7b9eb2712c12.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"a9b172b00bb14dbeb0a3993df095f5f7\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"RoY961Hqgq"}],"key":"WhdcRn2M6J"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ICESat-2 data over Cook Ice Shelf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zCK1otXY33"}],"identifier":"icesat-2-data-over-cook-ice-shelf","label":"ICESat-2 data over Cook Ice Shelf","html_id":"icesat-2-data-over-cook-ice-shelf","implicit":true,"key":"pACjCpapp7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For this tutorial, we’ll use the SlideRule service to download ATL06 (height measurements) and ATL03 (photon clouds).  SlideRule offers a quick and efficient way to search for and access data for limited areas of the ice sheet without the need to subset or download entire granules of data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vJt8R7FdwY"}],"key":"F4K8541HWZ"},{"type":"heading","depth":4,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Preliminary data download","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BZJ3RSaWDB"}],"identifier":"preliminary-data-download","label":"Preliminary data download","html_id":"preliminary-data-download","implicit":true,"key":"JYvKHkviE0"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Let’s begin by looking at the distibution of tracks for the region, using the ATL06 (land-ice height) product. We’ll first request a subset of data covering 2020.  To run SlideRule, we need a polygon (defined as a list of dictionaries, each of which has a ‘lat’ and a ‘lon’ element) and a start and stop time.  We’ll use the ATL06sp endpoint, which subsets all the granules in the region for a standard set of ATL06 fields.  The polygon we’re using comes from a kml file called Cook_subset.kml, which is in the assets/filtering directory.  You can substitute your own file if you want to work on a different area.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AiyEz92SPC"}],"key":"MtoXc3M86V"}],"key":"onoZpUnvYK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define a polygon in sliderule format.\npoly=[{'lat':jj[1], 'lon':jj[0]} for jj in geom_ll.exterior.coords]\n\n#Define the request (a dictionary of parameters, \n#see: https://slideruleearth.io/web/rtd/user_guide/icesat2.html#parameters\nsliderule_parms= {\n    \"poly\":poly,\n    \"t0\": \"2020-01-01T01:00:00Z\",\n    \"t1\": \"2021-01-01T01:01:01Z\",\n  }\n# submit the request, which should take 10-15 seconds\nD6=icesat2.atl06sp(sliderule_parms)\n# transform the output to polar stereographic coordinates\nD6.to_crs(3031, inplace=True)\n","key":"fWBZyR9Gv6"},{"type":"output","id":"sMKdiXT8qQdnn5EMoH93n","data":[],"key":"KsD51JLczF"}],"key":"zMq3z1vZHG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can take a look at the data that SlideRule returned to see what fields are present:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XrKjXjVBfw"}],"key":"OBJ5nyWYov"}],"key":"q0sWy4d1kt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"D6","key":"jguxvOR4bc"},{"type":"output","id":"joI5z9r2lrBbBs_1vSY6z","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"                                 bsnow_h  atl06_quality_summary  \\\ntime                                                              \n2020-01-02 19:53:02.195757568        NaN                      1   \n2020-01-02 19:53:02.209907968        NaN                      1   \n2020-01-02 19:53:02.269107712        NaN                      1   \n2020-01-02 19:53:02.291602432        NaN                      1   \n2020-01-02 19:53:02.308643328        NaN                      1   \n...                                  ...                    ...   \n2020-12-31 02:32:19.517601280  75.705276                      0   \n2020-12-31 02:32:19.520413952  76.277420                      0   \n2020-12-31 02:32:19.523228672  76.849426                      0   \n2020-12-31 02:32:19.526045952  77.421654                      0   \n2020-12-31 02:32:19.528866560  77.994514                      0   \n\n                               n_fit_photons         x_atc  dh_fit_dx  \\\ntime                                                                    \n2020-01-02 19:53:02.195757568             24  2.771537e+07  -0.097162   \n2020-01-02 19:53:02.209907968            174  2.771547e+07  -3.340194   \n2020-01-02 19:53:02.269107712             32  2.771601e+07  -0.628042   \n2020-01-02 19:53:02.291602432             22  2.771605e+07   0.034806   \n2020-01-02 19:53:02.308643328             32  2.771629e+07  -0.041310   \n...                                      ...           ...        ...   \n2020-12-31 02:32:19.517601280            131  2.773431e+07   0.016789   \n2020-12-31 02:32:19.520413952            124  2.773433e+07   0.013516   \n2020-12-31 02:32:19.523228672            124  2.773435e+07   0.013440   \n2020-12-31 02:32:19.526045952            129  2.773437e+07   0.020096   \n2020-12-31 02:32:19.528866560            126  2.773439e+07   0.013337   \n\n                               h_li_sigma  bsnow_conf  segment_id  \\\ntime                                                                \n2020-01-02 19:53:02.195757568    0.570025          -4     1384275   \n2020-01-02 19:53:02.209907968         NaN          -4     1384280   \n2020-01-02 19:53:02.269107712         NaN          -4     1384307   \n2020-01-02 19:53:02.291602432    0.727074          -4     1384309   \n2020-01-02 19:53:02.308643328         NaN          -4     1384321   \n...                                   ...         ...         ...   \n2020-12-31 02:32:19.517601280    0.027166          -2     1385226   \n2020-12-31 02:32:19.520413952    0.028296          -2     1385227   \n2020-12-31 02:32:19.523228672    0.039525          -2     1385228   \n2020-12-31 02:32:19.526045952    0.032543          -2     1385229   \n2020-12-31 02:32:19.528866560    0.027650          -2     1385230   \n\n                               sigma_geo_h  cycle  ...  \\\ntime                                               ...   \n2020-01-02 19:53:02.195757568     5.025305      6  ...   \n2020-01-02 19:53:02.209907968          NaN      6  ...   \n2020-01-02 19:53:02.269107712          NaN      6  ...   \n2020-01-02 19:53:02.291602432     5.004794      6  ...   \n2020-01-02 19:53:02.308643328          NaN      6  ...   \n...                                    ...    ...  ...   \n2020-12-31 02:32:19.517601280     0.156103     10  ...   \n2020-12-31 02:32:19.520413952     0.148099     10  ...   \n2020-12-31 02:32:19.523228672     0.148106     10  ...   \n2020-12-31 02:32:19.526045952     0.166181     10  ...   \n2020-12-31 02:32:19.528866560     0.148680     10  ...   \n\n                               w_surface_window_final        y_atc  \\\ntime                                                                 \n2020-01-02 19:53:02.195757568                6.681315    44.051380   \n2020-01-02 19:53:02.209907968               85.177063          NaN   \n2020-01-02 19:53:02.269107712               16.026264          NaN   \n2020-01-02 19:53:02.291602432                6.711609    43.920086   \n2020-01-02 19:53:02.308643328               11.799726          NaN   \n...                                               ...          ...   \n2020-12-31 02:32:19.517601280                3.000000  3310.738037   \n2020-12-31 02:32:19.520413952                3.000000  3310.662109   \n2020-12-31 02:32:19.523228672                3.000000  3310.520752   \n2020-12-31 02:32:19.526045952                3.000000  3310.318604   \n2020-12-31 02:32:19.528866560                3.000000  3310.088867   \n\n                               h_robust_sprd  rgt  spot  seg_azimuth  \\\ntime                                                                   \n2020-01-02 19:53:02.195757568       0.861015  108     4  -173.167130   \n2020-01-02 19:53:02.209907968       3.689145  108     4  -173.166962   \n2020-01-02 19:53:02.269107712       0.864407  108     2  -173.166290   \n2020-01-02 19:53:02.291602432       1.118602  108     4  -173.166031   \n2020-01-02 19:53:02.308643328       1.966621  108     2  -173.165833   \n...                                      ...  ...   ...          ...   \n2020-12-31 02:32:19.517601280       0.114252  108     2  -173.121323   \n2020-12-31 02:32:19.520413952       0.144688  108     2  -173.121292   \n2020-12-31 02:32:19.523228672       0.170934  108     2  -173.121262   \n2020-12-31 02:32:19.526045952       0.183370  108     2  -173.121231   \n2020-12-31 02:32:19.528866560       0.151708  108     2  -173.121185   \n\n                               tide_ocean     r_eff        h_li  \\\ntime                                                              \n2020-01-02 19:53:02.195757568         NaN  0.112080   96.577782   \n2020-01-02 19:53:02.209907968         NaN       NaN         NaN   \n2020-01-02 19:53:02.269107712         NaN       NaN         NaN   \n2020-01-02 19:53:02.291602432         NaN  0.091685  -28.034241   \n2020-01-02 19:53:02.308643328         NaN       NaN         NaN   \n...                                   ...       ...         ...   \n2020-12-31 02:32:19.517601280         NaN  1.488532  152.665161   \n2020-12-31 02:32:19.520413952         NaN  1.355845  152.956726   \n2020-12-31 02:32:19.523228672         NaN  1.329513  153.296890   \n2020-12-31 02:32:19.526045952         NaN  1.409520  153.602722   \n2020-12-31 02:32:19.528866560         NaN  1.390753  153.915085   \n\n                                                       geometry  \ntime                                                             \n2020-01-02 19:53:02.195757568  POINT (1134789.443 -2067157.569)  \n2020-01-02 19:53:02.209907968  POINT (1134752.635 -2067064.229)  \n2020-01-02 19:53:02.269107712  POINT (1137687.637 -2065298.619)  \n2020-01-02 19:53:02.291602432  POINT (1134534.808 -2066524.676)  \n2020-01-02 19:53:02.308643328  POINT (1137583.486 -2065037.715)  \n...                                                         ...  \n2020-12-31 02:32:19.517601280  POINT (1124610.332 -2050692.711)  \n2020-12-31 02:32:19.520413952  POINT (1124602.953 -2050674.066)  \n2020-12-31 02:32:19.523228672     POINT (1124595.6 -2050655.41)  \n2020-12-31 02:32:19.526045952  POINT (1124588.271 -2050636.745)  \n2020-12-31 02:32:19.528866560  POINT (1124580.959 -2050618.072)  \n\n[309540 rows x 21 columns]","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>bsnow_h</th>\n      <th>atl06_quality_summary</th>\n      <th>n_fit_photons</th>\n      <th>x_atc</th>\n      <th>dh_fit_dx</th>\n      <th>h_li_sigma</th>\n      <th>bsnow_conf</th>\n      <th>segment_id</th>\n      <th>sigma_geo_h</th>\n      <th>cycle</th>\n      <th>...</th>\n      <th>w_surface_window_final</th>\n      <th>y_atc</th>\n      <th>h_robust_sprd</th>\n      <th>rgt</th>\n      <th>spot</th>\n      <th>seg_azimuth</th>\n      <th>tide_ocean</th>\n      <th>r_eff</th>\n      <th>h_li</th>\n      <th>geometry</th>\n    </tr>\n    <tr>\n      <th>time</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2020-01-02 19:53:02.195757568</th>\n      <td>NaN</td>\n      <td>1</td>\n      <td>24</td>\n      <td>2.771537e+07</td>\n      <td>-0.097162</td>\n      <td>0.570025</td>\n      <td>-4</td>\n      <td>1384275</td>\n      <td>5.025305</td>\n      <td>6</td>\n      <td>...</td>\n      <td>6.681315</td>\n      <td>44.051380</td>\n      <td>0.861015</td>\n      <td>108</td>\n      <td>4</td>\n      <td>-173.167130</td>\n      <td>NaN</td>\n      <td>0.112080</td>\n      <td>96.577782</td>\n      <td>POINT (1134789.443 -2067157.569)</td>\n    </tr>\n    <tr>\n      <th>2020-01-02 19:53:02.209907968</th>\n      <td>NaN</td>\n      <td>1</td>\n      <td>174</td>\n      <td>2.771547e+07</td>\n      <td>-3.340194</td>\n      <td>NaN</td>\n      <td>-4</td>\n      <td>1384280</td>\n      <td>NaN</td>\n      <td>6</td>\n      <td>...</td>\n      <td>85.177063</td>\n      <td>NaN</td>\n      <td>3.689145</td>\n      <td>108</td>\n      <td>4</td>\n      <td>-173.166962</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>POINT (1134752.635 -2067064.229)</td>\n    </tr>\n    <tr>\n      <th>2020-01-02 19:53:02.269107712</th>\n      <td>NaN</td>\n      <td>1</td>\n      <td>32</td>\n      <td>2.771601e+07</td>\n      <td>-0.628042</td>\n      <td>NaN</td>\n      <td>-4</td>\n      <td>1384307</td>\n      <td>NaN</td>\n      <td>6</td>\n      <td>...</td>\n      <td>16.026264</td>\n      <td>NaN</td>\n      <td>0.864407</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.166290</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>POINT (1137687.637 -2065298.619)</td>\n    </tr>\n    <tr>\n      <th>2020-01-02 19:53:02.291602432</th>\n      <td>NaN</td>\n      <td>1</td>\n      <td>22</td>\n      <td>2.771605e+07</td>\n      <td>0.034806</td>\n      <td>0.727074</td>\n      <td>-4</td>\n      <td>1384309</td>\n      <td>5.004794</td>\n      <td>6</td>\n      <td>...</td>\n      <td>6.711609</td>\n      <td>43.920086</td>\n      <td>1.118602</td>\n      <td>108</td>\n      <td>4</td>\n      <td>-173.166031</td>\n      <td>NaN</td>\n      <td>0.091685</td>\n      <td>-28.034241</td>\n      <td>POINT (1134534.808 -2066524.676)</td>\n    </tr>\n    <tr>\n      <th>2020-01-02 19:53:02.308643328</th>\n      <td>NaN</td>\n      <td>1</td>\n      <td>32</td>\n      <td>2.771629e+07</td>\n      <td>-0.041310</td>\n      <td>NaN</td>\n      <td>-4</td>\n      <td>1384321</td>\n      <td>NaN</td>\n      <td>6</td>\n      <td>...</td>\n      <td>11.799726</td>\n      <td>NaN</td>\n      <td>1.966621</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.165833</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>POINT (1137583.486 -2065037.715)</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2020-12-31 02:32:19.517601280</th>\n      <td>75.705276</td>\n      <td>0</td>\n      <td>131</td>\n      <td>2.773431e+07</td>\n      <td>0.016789</td>\n      <td>0.027166</td>\n      <td>-2</td>\n      <td>1385226</td>\n      <td>0.156103</td>\n      <td>10</td>\n      <td>...</td>\n      <td>3.000000</td>\n      <td>3310.738037</td>\n      <td>0.114252</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.121323</td>\n      <td>NaN</td>\n      <td>1.488532</td>\n      <td>152.665161</td>\n      <td>POINT (1124610.332 -2050692.711)</td>\n    </tr>\n    <tr>\n      <th>2020-12-31 02:32:19.520413952</th>\n      <td>76.277420</td>\n      <td>0</td>\n      <td>124</td>\n      <td>2.773433e+07</td>\n      <td>0.013516</td>\n      <td>0.028296</td>\n      <td>-2</td>\n      <td>1385227</td>\n      <td>0.148099</td>\n      <td>10</td>\n      <td>...</td>\n      <td>3.000000</td>\n      <td>3310.662109</td>\n      <td>0.144688</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.121292</td>\n      <td>NaN</td>\n      <td>1.355845</td>\n      <td>152.956726</td>\n      <td>POINT (1124602.953 -2050674.066)</td>\n    </tr>\n    <tr>\n      <th>2020-12-31 02:32:19.523228672</th>\n      <td>76.849426</td>\n      <td>0</td>\n      <td>124</td>\n      <td>2.773435e+07</td>\n      <td>0.013440</td>\n      <td>0.039525</td>\n      <td>-2</td>\n      <td>1385228</td>\n      <td>0.148106</td>\n      <td>10</td>\n      <td>...</td>\n      <td>3.000000</td>\n      <td>3310.520752</td>\n      <td>0.170934</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.121262</td>\n      <td>NaN</td>\n      <td>1.329513</td>\n      <td>153.296890</td>\n      <td>POINT (1124595.6 -2050655.41)</td>\n    </tr>\n    <tr>\n      <th>2020-12-31 02:32:19.526045952</th>\n      <td>77.421654</td>\n      <td>0</td>\n      <td>129</td>\n      <td>2.773437e+07</td>\n      <td>0.020096</td>\n      <td>0.032543</td>\n      <td>-2</td>\n      <td>1385229</td>\n      <td>0.166181</td>\n      <td>10</td>\n      <td>...</td>\n      <td>3.000000</td>\n      <td>3310.318604</td>\n      <td>0.183370</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.121231</td>\n      <td>NaN</td>\n      <td>1.409520</td>\n      <td>153.602722</td>\n      <td>POINT (1124588.271 -2050636.745)</td>\n    </tr>\n    <tr>\n      <th>2020-12-31 02:32:19.528866560</th>\n      <td>77.994514</td>\n      <td>0</td>\n      <td>126</td>\n      <td>2.773439e+07</td>\n      <td>0.013337</td>\n      <td>0.027650</td>\n      <td>-2</td>\n      <td>1385230</td>\n      <td>0.148680</td>\n      <td>10</td>\n      <td>...</td>\n      <td>3.000000</td>\n      <td>3310.088867</td>\n      <td>0.151708</td>\n      <td>108</td>\n      <td>2</td>\n      <td>-173.121185</td>\n      <td>NaN</td>\n      <td>1.390753</td>\n      <td>153.915085</td>\n      <td>POINT (1124580.959 -2050618.072)</td>\n    </tr>\n  </tbody>\n</table>\n<p>309540 rows × 21 columns</p>\n</div>","content_type":"text/html"}}}],"key":"SPhR7MMlMZ"}],"key":"OncWSNqArJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There are 21 columns here, which describe:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"llhz7WheXy"}],"key":"zeqhnpwJ0O"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"segment location (geometry)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sosvRS9FFp"}],"key":"DMWtMDrMdZ"}],"key":"wn7JJQvI6g"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"segment location along-track coordinates ( x_atc, y_atc )","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sieaNyLXOl"}],"key":"qgbUeFkzIT"}],"key":"N9iDPuC51H"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"surface height and accuracy (h_li, h_li_sigma, atl06_quality_summary)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yPfLdBnYlS"}],"key":"xYlr2iSBOe"}],"key":"xlSbtRDF1N"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"surface slope (dh_fit_dx, dh_fit_dy)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"g8aHcHMwdO"}],"key":"iNAfcOCZu1"}],"key":"MVTJu3IYAx"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"signal (r_eff, n_fit_photons)","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"u553B3oVTi"}],"key":"lgI66UIjWx"}],"key":"SpNpzPNeFn"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"track and timing parameters (cycle, gt, cycle, spot, delta_time)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"zoknehcvaE"}],"key":"hBCczT1gzq"}],"key":"EzCfavLUoj"}],"key":"XJfAo3IJpj"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The list of fields is designed to cover almost all users’ needs, and we’ll only end up using a few of them in this tutorial.  Let’s look at the elevations (h_li) that came back in the current request in map view.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BysyQh4Aof"}],"key":"Nqc8vvx8Rc"}],"key":"bSih1gBykT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure()\nax_scat = plt.gca()\nplt.imshow(shaded_relief_img['data'], extent=shaded_relief_img['extent'])\n\nxx=np.array(D6.geometry.x)\nyy=np.array(D6.geometry.y)\nhh = np.array(D6.h_li)\n\n# sort the data by abs(height) to make the outliers show up\nii=np.argsort(np.abs(hh))\nii=ii[np.isfinite(hh[ii])]\nh_scat=plt.scatter(xx[ii], yy[ii], 3,  c=hh[ii], clim=[-200, 200], cmap='RdBu')\nplt.colorbar(h_scat, label='h_li')\n\n# suggested area to look at a poorly performing segment:\nxl, yl = [np.array([1079194.72014081, 1080624.2833137 ]), np.array([-2089358.21884508, -2088030.7673274 ])]\n\nplt.plot(xl[[0, 0, 1, 1, 0]], yl[[0, 1, 1, 0, 0]],'--', color='palegreen', marker='*', linewidth=2)","key":"h7pIEI9mPP"},{"type":"output","id":"vwqVBh7cDIR2heBaVBvIj","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"939885317ce5b091647e3639901c9e1c","path":"/icesat2-cookbook/_preview/26/build/939885317ce5b091647e3639901c9e1c.png"},"text/html":{"content_type":"text/html","hash":"0327e4a1b209f1eb28a290ca98445ab3","path":"/icesat2-cookbook/_preview/26/build/0327e4a1b209f1eb28a290ca98445ab3.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"4c2d9aa5761348789d05d55bebb29e85\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"NESIO8Ly28"}],"key":"DBFTu55X1H"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can see on this plot that most of the surface heights are close to sea level, but a few tracks are reporting heights that are probably far too high.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PrEOoiS2vm"}],"key":"un2g498Oed"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Selecting a track that has cloud problems","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S51jfdipyn"}],"identifier":"selecting-a-track-that-has-cloud-problems","label":"Selecting a track that has cloud problems","html_id":"selecting-a-track-that-has-cloud-problems","implicit":true,"key":"M6IhmM3YYh"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"If you see a plot like this where there is a track that has problems, you need to figure out which track is affected.  To do this, you need to know which RGT (repeat ground track) has the problem, and which beams from that track are affected.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ez0aSofzjI"}],"key":"UKvQtIIfBx"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"One way to do this is to use the zoom tool to find a track with large positive h_li values, and capture the axes x_lim and y_lim properties, then use the dataframe’s ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JKx3Am5Fuu"},{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"cx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WHVZr3LvX7"}],"key":"fJF41yhOe3"},{"type":"text","value":" method to capture the subset of the dataframe within the axes.  You can do this by setting ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"I9vkpRVVh8"},{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"‘interactive’","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uu5zvp6fMm"}],"key":"EFb9UOBE57"},{"type":"text","value":" to ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"COMTRB6O5z"},{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"True","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sFnD60Zf3Q"}],"key":"XLn72y6IBt"},{"type":"text","value":" in the next cell.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"HwmdPDVSLn"}],"key":"CI8GyoFlwE"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"For puruposes of making the tutorial run without any interaction, I’ve also defined some limits in the next cell, and I’ll be talking about the results that come from those limits.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"pRJUa7jYeJ"}],"key":"AUP4jw2qAw"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"AAnaUnUWWa"}],"key":"RcHaEhkkrY"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The next cell is where you can change the ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"weA06e0LoF"},{"type":"emphasis","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"‘interactive’","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"tCsYs62a5Z"}],"key":"fRqflSqpsw"},{"type":"text","value":" variable to ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"OuRKFCoMeZ"},{"type":"emphasis","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"True","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"R6ZsJyW2ux"}],"key":"sv8MPHeMjE"},{"type":"text","value":", and use the zoom tool to find different tracks for which you can plot the ATL03 photons","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"LIX8Gdua9n"}],"key":"AxPra7HENS"}],"key":"LEB5Uuzpqb"}],"key":"Yob56GSsU4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# if interactive is False, we'll use the xl, yl defined in the previous code cell\ninteractive=False\n\nif interactive:\n    xl=ax_scat.get_xlim() ; yl=ax_scat.get_ylim()\nD6_sub= D6.cx[xl[0]:xl[1], yl[0]:yl[1]]\nD6_sub","key":"Skx4vvkIHx"},{"type":"output","id":"sfXXfNvugJYBDMmzY2HfP","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"                                 bsnow_h  atl06_quality_summary  \\\ntime                                                              \n2020-06-17 00:31:30.663101184  29.979246                      1   \n2020-06-17 00:31:30.699512832  29.979246                      1   \n2020-06-17 00:31:30.702129664  29.979246                      1   \n2020-06-17 00:31:30.705491456  29.979246                      1   \n2020-06-17 00:31:30.741478656  29.979246                      1   \n...                                  ...                    ...   \n2020-12-15 15:51:11.560632576  29.979246                      1   \n2020-12-15 15:51:11.569319680  29.979246                      1   \n2020-12-15 15:51:11.572571904  29.979246                      1   \n2020-12-15 15:51:11.575389440  29.979246                      1   \n2020-12-15 15:51:11.586318848  29.979246                      1   \n\n                               n_fit_photons         x_atc  dh_fit_dx  \\\ntime                                                                    \n2020-06-17 00:31:30.663101184             19  3.249150e+07  -0.018786   \n2020-06-17 00:31:30.699512832             16  3.249176e+07  -0.050294   \n2020-06-17 00:31:30.702129664             21  3.249178e+07  -0.383822   \n2020-06-17 00:31:30.705491456             21  3.249180e+07   0.530386   \n2020-06-17 00:31:30.741478656             23  3.249206e+07  -0.136651   \n...                                      ...           ...        ...   \n2020-12-15 15:51:11.560632576              0  3.249268e+07        NaN   \n2020-12-15 15:51:11.569319680              0  3.249274e+07        NaN   \n2020-12-15 15:51:11.572571904             14  3.249276e+07   1.679062   \n2020-12-15 15:51:11.575389440             12  3.249278e+07  -1.104032   \n2020-12-15 15:51:11.586318848              0  3.249286e+07        NaN   \n\n                               h_li_sigma  bsnow_conf  segment_id  \\\ntime                                                                \n2020-06-17 00:31:30.663101184    6.573936          -4     1624282   \n2020-06-17 00:31:30.699512832    1.442339          -4     1624295   \n2020-06-17 00:31:30.702129664    2.813699          -4     1624296   \n2020-06-17 00:31:30.705491456    4.716102          -4     1624297   \n2020-06-17 00:31:30.741478656    4.090336          -4     1624310   \n...                                   ...         ...         ...   \n2020-12-15 15:51:11.560632576         NaN          -4     1624341   \n2020-12-15 15:51:11.569319680         NaN          -4     1624344   \n2020-12-15 15:51:11.572571904   11.365804          -4     1624345   \n2020-12-15 15:51:11.575389440   10.836848          -4     1624346   \n2020-12-15 15:51:11.586318848         NaN          -4     1624350   \n\n                               sigma_geo_h  cycle  ...  \\\ntime                                               ...   \n2020-06-17 00:31:30.663101184     5.002589      7  ...   \n2020-06-17 00:31:30.699512832     5.008024      7  ...   \n2020-06-17 00:31:30.702129664     5.357243      7  ...   \n2020-06-17 00:31:30.705491456     5.661255      7  ...   \n2020-06-17 00:31:30.741478656     5.048159      7  ...   \n...                                    ...    ...  ...   \n2020-12-15 15:51:11.560632576          NaN      9  ...   \n2020-12-15 15:51:11.569319680          NaN      9  ...   \n2020-12-15 15:51:11.572571904     9.772370      9  ...   \n2020-12-15 15:51:11.575389440     7.449172      9  ...   \n2020-12-15 15:51:11.586318848          NaN      9  ...   \n\n                               w_surface_window_final        y_atc  \\\ntime                                                                 \n2020-06-17 00:31:30.663101184                30.00000  3399.245117   \n2020-06-17 00:31:30.699512832                30.00000  3399.033203   \n2020-06-17 00:31:30.702129664                30.00000  3398.996094   \n2020-06-17 00:31:30.705491456                30.00000  3398.979980   \n2020-06-17 00:31:30.741478656                30.00000  3399.297363   \n...                                               ...          ...   \n2020-12-15 15:51:11.560632576                     NaN          NaN   \n2020-12-15 15:51:11.569319680                     NaN          NaN   \n2020-12-15 15:51:11.572571904                42.82019  3313.260254   \n2020-12-15 15:51:11.575389440                30.00000  3313.027832   \n2020-12-15 15:51:11.586318848                     NaN          NaN   \n\n                               h_robust_sprd   rgt  spot  seg_azimuth  \\\ntime                                                                    \n2020-06-17 00:31:30.663101184       5.000000  1259     1    -6.845011   \n2020-06-17 00:31:30.699512832       5.000000  1259     1    -6.844585   \n2020-06-17 00:31:30.702129664       5.000000  1259     1    -6.844554   \n2020-06-17 00:31:30.705491456       5.000000  1259     1    -6.844522   \n2020-06-17 00:31:30.741478656       5.000000  1259     1    -6.844103   \n...                                      ...   ...   ...          ...   \n2020-12-15 15:51:11.560632576            NaN  1259     2    -6.849295   \n2020-12-15 15:51:11.569319680            NaN  1259     2    -6.849197   \n2020-12-15 15:51:11.572571904       4.406725  1259     2    -6.849166   \n2020-12-15 15:51:11.575389440       5.000000  1259     2    -6.849132   \n2020-12-15 15:51:11.586318848            NaN  1259     2    -6.849003   \n\n                               tide_ocean     r_eff         h_li  \\\ntime                                                               \n2020-06-17 00:31:30.663101184    0.339521  0.036044  1634.320679   \n2020-06-17 00:31:30.699512832    0.339523  0.030038  1625.452515   \n2020-06-17 00:31:30.702129664    0.339523  0.040061  1622.121460   \n2020-06-17 00:31:30.705491456    0.339523  0.040048  1623.155273   \n2020-06-17 00:31:30.741478656    0.339524  0.044078  1629.631958   \n...                                   ...       ...          ...   \n2020-12-15 15:51:11.560632576    0.860845       NaN          NaN   \n2020-12-15 15:51:11.569319680    0.860849       NaN          NaN   \n2020-12-15 15:51:11.572571904    0.860851  0.014209    67.306694   \n2020-12-15 15:51:11.575389440    0.860852  0.029205    40.882034   \n2020-12-15 15:51:11.586318848    0.860858       NaN          NaN   \n\n                                                       geometry  \ntime                                                             \n2020-06-17 00:31:30.663101184  POINT (1079460.892 -2088075.724)  \n2020-06-17 00:31:30.699512832   POINT (1079605.49 -2088289.513)  \n2020-06-17 00:31:30.702129664  POINT (1079615.988 -2088305.043)  \n2020-06-17 00:31:30.705491456  POINT (1079629.426 -2088324.988)  \n2020-06-17 00:31:30.741478656  POINT (1079773.586 -2088537.173)  \n...                                                         ...  \n2020-12-15 15:51:11.560632576   POINT (1080067.705 -2089094.33)  \n2020-12-15 15:51:11.569319680  POINT (1080101.957 -2089143.816)  \n2020-12-15 15:51:11.572571904  POINT (1080097.673 -2089170.799)  \n2020-12-15 15:51:11.575389440   POINT (1080109.007 -2089187.35)  \n2020-12-15 15:51:11.586318848  POINT (1080167.699 -2089244.658)  \n\n[265 rows x 21 columns]","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>bsnow_h</th>\n      <th>atl06_quality_summary</th>\n      <th>n_fit_photons</th>\n      <th>x_atc</th>\n      <th>dh_fit_dx</th>\n      <th>h_li_sigma</th>\n      <th>bsnow_conf</th>\n      <th>segment_id</th>\n      <th>sigma_geo_h</th>\n      <th>cycle</th>\n      <th>...</th>\n      <th>w_surface_window_final</th>\n      <th>y_atc</th>\n      <th>h_robust_sprd</th>\n      <th>rgt</th>\n      <th>spot</th>\n      <th>seg_azimuth</th>\n      <th>tide_ocean</th>\n      <th>r_eff</th>\n      <th>h_li</th>\n      <th>geometry</th>\n    </tr>\n    <tr>\n      <th>time</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2020-06-17 00:31:30.663101184</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>19</td>\n      <td>3.249150e+07</td>\n      <td>-0.018786</td>\n      <td>6.573936</td>\n      <td>-4</td>\n      <td>1624282</td>\n      <td>5.002589</td>\n      <td>7</td>\n      <td>...</td>\n      <td>30.00000</td>\n      <td>3399.245117</td>\n      <td>5.000000</td>\n      <td>1259</td>\n      <td>1</td>\n      <td>-6.845011</td>\n      <td>0.339521</td>\n      <td>0.036044</td>\n      <td>1634.320679</td>\n      <td>POINT (1079460.892 -2088075.724)</td>\n    </tr>\n    <tr>\n      <th>2020-06-17 00:31:30.699512832</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>16</td>\n      <td>3.249176e+07</td>\n      <td>-0.050294</td>\n      <td>1.442339</td>\n      <td>-4</td>\n      <td>1624295</td>\n      <td>5.008024</td>\n      <td>7</td>\n      <td>...</td>\n      <td>30.00000</td>\n      <td>3399.033203</td>\n      <td>5.000000</td>\n      <td>1259</td>\n      <td>1</td>\n      <td>-6.844585</td>\n      <td>0.339523</td>\n      <td>0.030038</td>\n      <td>1625.452515</td>\n      <td>POINT (1079605.49 -2088289.513)</td>\n    </tr>\n    <tr>\n      <th>2020-06-17 00:31:30.702129664</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>21</td>\n      <td>3.249178e+07</td>\n      <td>-0.383822</td>\n      <td>2.813699</td>\n      <td>-4</td>\n      <td>1624296</td>\n      <td>5.357243</td>\n      <td>7</td>\n      <td>...</td>\n      <td>30.00000</td>\n      <td>3398.996094</td>\n      <td>5.000000</td>\n      <td>1259</td>\n      <td>1</td>\n      <td>-6.844554</td>\n      <td>0.339523</td>\n      <td>0.040061</td>\n      <td>1622.121460</td>\n      <td>POINT (1079615.988 -2088305.043)</td>\n    </tr>\n    <tr>\n      <th>2020-06-17 00:31:30.705491456</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>21</td>\n      <td>3.249180e+07</td>\n      <td>0.530386</td>\n      <td>4.716102</td>\n      <td>-4</td>\n      <td>1624297</td>\n      <td>5.661255</td>\n      <td>7</td>\n      <td>...</td>\n      <td>30.00000</td>\n      <td>3398.979980</td>\n      <td>5.000000</td>\n      <td>1259</td>\n      <td>1</td>\n      <td>-6.844522</td>\n      <td>0.339523</td>\n      <td>0.040048</td>\n      <td>1623.155273</td>\n      <td>POINT (1079629.426 -2088324.988)</td>\n    </tr>\n    <tr>\n      <th>2020-06-17 00:31:30.741478656</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>23</td>\n      <td>3.249206e+07</td>\n      <td>-0.136651</td>\n      <td>4.090336</td>\n      <td>-4</td>\n      <td>1624310</td>\n      <td>5.048159</td>\n      <td>7</td>\n      <td>...</td>\n      <td>30.00000</td>\n      <td>3399.297363</td>\n      <td>5.000000</td>\n      <td>1259</td>\n      <td>1</td>\n      <td>-6.844103</td>\n      <td>0.339524</td>\n      <td>0.044078</td>\n      <td>1629.631958</td>\n      <td>POINT (1079773.586 -2088537.173)</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2020-12-15 15:51:11.560632576</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>0</td>\n      <td>3.249268e+07</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>-4</td>\n      <td>1624341</td>\n      <td>NaN</td>\n      <td>9</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1259</td>\n      <td>2</td>\n      <td>-6.849295</td>\n      <td>0.860845</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>POINT (1080067.705 -2089094.33)</td>\n    </tr>\n    <tr>\n      <th>2020-12-15 15:51:11.569319680</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>0</td>\n      <td>3.249274e+07</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>-4</td>\n      <td>1624344</td>\n      <td>NaN</td>\n      <td>9</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1259</td>\n      <td>2</td>\n      <td>-6.849197</td>\n      <td>0.860849</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>POINT (1080101.957 -2089143.816)</td>\n    </tr>\n    <tr>\n      <th>2020-12-15 15:51:11.572571904</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>14</td>\n      <td>3.249276e+07</td>\n      <td>1.679062</td>\n      <td>11.365804</td>\n      <td>-4</td>\n      <td>1624345</td>\n      <td>9.772370</td>\n      <td>9</td>\n      <td>...</td>\n      <td>42.82019</td>\n      <td>3313.260254</td>\n      <td>4.406725</td>\n      <td>1259</td>\n      <td>2</td>\n      <td>-6.849166</td>\n      <td>0.860851</td>\n      <td>0.014209</td>\n      <td>67.306694</td>\n      <td>POINT (1080097.673 -2089170.799)</td>\n    </tr>\n    <tr>\n      <th>2020-12-15 15:51:11.575389440</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>12</td>\n      <td>3.249278e+07</td>\n      <td>-1.104032</td>\n      <td>10.836848</td>\n      <td>-4</td>\n      <td>1624346</td>\n      <td>7.449172</td>\n      <td>9</td>\n      <td>...</td>\n      <td>30.00000</td>\n      <td>3313.027832</td>\n      <td>5.000000</td>\n      <td>1259</td>\n      <td>2</td>\n      <td>-6.849132</td>\n      <td>0.860852</td>\n      <td>0.029205</td>\n      <td>40.882034</td>\n      <td>POINT (1080109.007 -2089187.35)</td>\n    </tr>\n    <tr>\n      <th>2020-12-15 15:51:11.586318848</th>\n      <td>29.979246</td>\n      <td>1</td>\n      <td>0</td>\n      <td>3.249286e+07</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>-4</td>\n      <td>1624350</td>\n      <td>NaN</td>\n      <td>9</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1259</td>\n      <td>2</td>\n      <td>-6.849003</td>\n      <td>0.860858</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>POINT (1080167.699 -2089244.658)</td>\n    </tr>\n  </tbody>\n</table>\n<p>265 rows × 21 columns</p>\n</div>","content_type":"text/html"}}}],"key":"VZUSYhHHnY"}],"key":"Nywk0a0jse"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you run this for the default region, you’ll see that there is one rgt (1259), and two gts (10 and 20) in the polygon.  Let’s do a plot of the height against the along-track coordinate:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sk0xxsPHl7"}],"key":"pFZufwYbjo"}],"key":"CqEoSyqlRb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure()\nhs=plt.scatter(D6_sub.x_atc, D6_sub.h_li,5, c=D6_sub.cycle)\nplt.colorbar(hs, label='cycle_number')\nplt.gca().set_xlabel('along-track x (x_atc), m')\nplt.gca().set_ylabel('h, m')\n","key":"arfAtHp0ff"},{"type":"output","id":"PcXIlrrZkJc_4m03p1uKc","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0155fecab05ef6588233cf4ad377f433","path":"/icesat2-cookbook/_preview/26/build/0155fecab05ef6588233cf4ad377f433.png"},"text/html":{"content_type":"text/html","hash":"1f5786763401c812654ea56ff39cfa0a","path":"/icesat2-cookbook/_preview/26/build/1f5786763401c812654ea56ff39cfa0a.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"0e6378ad028748aa80fcfbb3f5dcc02f\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"jAjJSOYucS"}],"key":"nRkL3oJvrw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you’re using the default location, this plot shows heights near zero for cycle 8, and elevations far above and below the surface for cycles 7 and 9.  If we zoom in on cycle 8, we can see something that looks like ice-shelf terrain, so we can guess that this is probably “right” and cycles 7 and 9 are wrong.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zrbYS1pbEL"}],"key":"HTFS0EDtuH"}],"key":"fV9uDc3MKJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Getting ATL03 data for a problematic track","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LbebTTZV8d"}],"identifier":"getting-atl03-data-for-a-problematic-track","label":"Getting ATL03 data for a problematic track","html_id":"getting-atl03-data-for-a-problematic-track","implicit":true,"key":"H6Rn00T3Up"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The next step is to look at the ATL03 photon cloud for each cycle to see what has worked and what has not.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YHOhn6nKDN"}],"key":"gaAPHLOacb"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"TEPWuX1nxv"}],"key":"xSwcScBlyv"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"If you’re running in interactive mode, copy the track (RGT) and pair track from the subsetted dataframe above.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xAxltoFP72"}],"key":"KW6LypDgSQ"}],"key":"i9yscNOVTz"}],"key":"A3wFDMCuzy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# set the rgt and pair track here:\nthis_rgt=1259\nthis_track=1","key":"YWFNlFsr6L"},{"type":"output","id":"kRbeHo8ARdXQSrQDenxAc","data":[],"key":"l4a4nBsYIP"}],"key":"EPtp9eoYH0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Get ATL03.  this should take <1 minute to run.\n\nicesat2.init(\"slideruleearth.io\", True)\nsliderule_ATL03_parms= {\n    \"poly\":poly, \n    \"t0\": \"2020-01-01T01:00:00Z\",\n    \"t1\": \"2021-01-01T01:00:00Z\",\n    \"rgt\":this_rgt,\n    \"srt\":icesat2.SRT_LAND_ICE,\n    \"cnf\":-2,\n    \"track\": this_track,\n  }\n# run sliderule for track\nD3=sliderule.run('atl03x', sliderule_ATL03_parms).to_crs(3031)\n\n# make a subset for our geographic region\nD3_sub = D3.cx[xl[0]:xl[1], yl[0]:yl[1]]","key":"sXUzdaXDzF"},{"type":"output","id":"NXDfUTaR1gX9BO-X6aS77","data":[],"key":"oGtn00lKkQ"}],"key":"B2t2f2uWaf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s plot the photons from ATL03, and the segments from ATL06 for each beam in pair 1 for each cycle.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xmPNaNdhbX"}],"key":"zXvssMCHwS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Note that SlideRule has numeric codes for the different groundtracks, so","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JSrx7ybnDI"}],"key":"N8vy77ifNU"},{"type":"code","lang":"","value":"gt=10 -> gt1l\n\ngt=20 -> gt1r","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"key":"VvWWaLnwB6"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The SlideRule icesat2 module has ‘GT1L’,‘GT1R’,‘GT2L’ attributes that provide these numeric codes.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NmMcghgGdd"}],"key":"WhLMHNSwHd"}],"key":"JgCImhJitb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hf, hax= plt.subplots(3, 2, layout='constrained', sharex=True, figsize=[8, 8])\n\nfor ax1, cycle in zip(hax, np.unique(np.array(D6_sub.cycle))):\n    for ax, gt in zip(ax1, np.unique(np.array(D6_sub['gt']))):\n        i3=(D3_sub['gt']==gt) & (D3_sub.cycle==cycle)\n        ax.plot(D3_sub.x_atc[i3], D3_sub.height[i3],'k.', markersize=1, label='ATL03')\n        i6=(D6_sub['gt']==gt) & (D6_sub.cycle==cycle)\n        ax.plot(D6_sub.x_atc[i6], D6_sub.h_li[i6],'.', color='steelblue', label='ATL06')\n        ax.set_title(f'cycle={cycle}, gt={gt}')\nhax[1, 1].legend()\n\nfor ax in hax[2,:]:\n    ax.set_xlabel('x_atc, m')\nfor ax in hax[:,0]:\n    ax.set_ylabel('WGS84 height, m')","key":"tbEQZq1OWa"},{"type":"output","id":"o64Q155LXPGIvUpzq6-Qc","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"eae55dedb063408d44596f32e7e749d7","path":"/icesat2-cookbook/_preview/26/build/eae55dedb063408d44596f32e7e749d7.png"},"text/html":{"content_type":"text/html","hash":"bbee12ba9e321349097d3a9eaf9039b2","path":"/icesat2-cookbook/_preview/26/build/bbee12ba9e321349097d3a9eaf9039b2.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"dec5533dfbaf4d219165484d242254db\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"HsELl36QkY"}],"key":"KvPmr2aMCZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can see a few things going on here.  The photons in ATL03 come from vertical bands of data (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z6YCBDgu99"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"telemetry bands","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l1jcqd2fzj"}],"key":"QGa4uiKTmu"},{"type":"text","value":") that the algorithms running onboard ATLAS have identified as possibly containing a ground return.  In some cases the algorithm is correct (e.g. cycle 8), in other cases it returns only a band of photons far from the ground (gt 10 for cycles 7 and 9) or returns a band of photons that contains the ground for which there is no usable return (gt 20 for cycles 7 and 9).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E9tvQcp91N"}],"key":"jqya1C5Mmr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We can also see bands of photons above the ground in gt 10 for cycles 7 and 8: these are most likely clouds, and the photons in these bands are much farther apart than the photons from true ground returns (see cycle 8).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"F7QxMpRKNi"}],"key":"KomKyOvPXn"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"All of the tracks contain at least some background photons, which are uniformly distributed over the telemetry bands.  If you check the dates for the different cycles, you’ll see that cycle 7 comes from June (Antarctic winter), cycle 8 comes from mid September (late winter / early spring) and cycle 9 comes from mid December (high summer).  As a result, there are very few background photons in cycle 7, and very many in cycle 9.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"O8eRVBlLgD"}],"key":"Eyq7mWjqYx"}],"key":"XYexgXKNJo"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plotting ATL03 signal classifications","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RksxfLa4GD"}],"identifier":"plotting-atl03-signal-classifications","label":"Plotting ATL03 signal classifications","html_id":"plotting-atl03-signal-classifications","implicit":true,"key":"vCDzYjaOoy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"It’s instructive to see how the ATL03 classification algorithm sees these points.  Let’s do the plot again, but color code by signal classification.  These are stored in the ATL03 atl03_cnf field.  the confidence values are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mN5MLIe4pJ"}],"key":"fxDL5O8Aaz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"-- -1: Events not associated with a specific surface type","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oKmm2R1Wp4"}],"key":"CcevUCrxDO"}],"key":"K93tB8NihI"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"--  0: noise","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"EKUCssGQdb"}],"key":"antdjuuLkW"}],"key":"wO1bxZ9nGF"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"--  1: noise photons within a +-10 m vertical buffer of a detected photon","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IAPO7UTYsI"}],"key":"UiaiRzP5Fu"}],"key":"S37rvQ8tp6"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"--  2: low confidence signal","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"aCAwGtbETR"}],"key":"fvvlnq58Lv"}],"key":"nS09hjwAmB"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"--  3: medium confidence signal","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"j0mvv9U57i"}],"key":"j8zpvK2gtn"}],"key":"bB7iqGbOB2"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"--  4: high confidence signal","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"gF2879YrQM"}],"key":"HONZ1KNkxA"}],"key":"psmU4tVCX6"}],"key":"HBf0FYSaDs"}],"key":"JSbV0OZnW5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hf, hax= plt.subplots(3, 2, layout='constrained', sharex=True, figsize=[8, 8])\n\nfor ax1, cycle in zip(hax, np.unique(np.array(D6_sub.cycle))):\n    for ax, gt in zip(ax1, np.unique(np.array(D6_sub['gt']))):\n        for cnf, name, color in zip([-1, 0, 1, 2, 3, 4], ['unclassified', 'noise','buffer','low','medium','high'],['gray', 'black','skyblue','green','orange','red']):\n            i3=(D3_sub['gt']==gt) & (D3_sub.cycle==cycle) & (D3_sub.atl03_cnf==cnf)\n            ax.plot(D3_sub.x_atc[i3], D3_sub.height[i3],'.', markersize=1, color=color, label=name)\n        ax.set_title(f'cycle={cycle}, gt={gt}')\nhax[1, 0].legend()\n\nfor ax in hax[2,:]:\n    ax.set_xlabel('x_atc, m')\nfor ax in hax[:,0]:\n    ax.set_ylabel('WGS84 height, m')","key":"KZJ5OyQ9tA"},{"type":"output","id":"qlYQ2VKCUDCrYHorCriNb","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"722f377960434c8eb88f19808b1c7c85","path":"/icesat2-cookbook/_preview/26/build/722f377960434c8eb88f19808b1c7c85.png"},"text/html":{"content_type":"text/html","hash":"def6db008b96b6ed2397f59f94f8ba65","path":"/icesat2-cookbook/_preview/26/build/def6db008b96b6ed2397f59f94f8ba65.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"01b4a49f0e9b4bb6a90726ed23f6a5e5\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"trPeJ4pobi"}],"key":"CMqB1NixWz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you zoom around a little bit, you’ll see that cycles 7 and 9 have essentially all photons classified as noise, but cycle 8 has a mixture of high-confidence and (for gt==20) medium/low photons.  The low - confidence photons come from places where the surface is unusually dim, probably because of cloud attenuation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WNlUts8gMU"}],"key":"IlrJWAGpy6"}],"key":"uYZ683lHJ2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Relating cloud effects to ATL06 data parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x3ToB8In8w"}],"identifier":"relating-cloud-effects-to-atl06-data-parameters","label":"Relating cloud effects to ATL06 data parameters","html_id":"relating-cloud-effects-to-atl06-data-parameters","implicit":true,"key":"e8Hnjrfgh9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Our problem comes when the ground return is not strong enough to trigger the signal finder, and we start to see triggers associated with:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HMcI1WOWe0"}],"key":"lctknTSofx"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Cloud tops","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZlV9aVoYNo"}],"key":"a01LTmhUwY"}],"key":"dERbdwG0e9"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Random clusterings of background photons","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sBDmk77sAK"}],"key":"gg3NsncjtN"}],"key":"YHvDHYk6rF"}],"key":"Wpz0tzW3yA"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"These should both be statistically distinct from surface returns because:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"XcAGc6ch8i"}],"key":"NyFem47FxN"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The returns are less intense than a high-quality surface return","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"accNwcYQEy"}],"key":"iegPI0oDPx"}],"key":"OxajDnwjw4"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The photons are more widely vertcally spread than those in surface returns","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eTxwBlRvAM"}],"key":"SfRrQ5NPSV"}],"key":"MSWYKk5eiP"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The surface window cannot converge on a small vertical window around the surface","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ch04df2rEO"}],"key":"iWTK22a3kZ"}],"key":"BWMAI1WGeK"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Surface heights and slopes are not consistent between adjacent segments","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"KJEAOUkUmX"}],"key":"honzK2wUbv"}],"key":"kSVMBCU5MD"}],"key":"k2AZIHR7Sb"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"There are a few ATL06 parameters that help quantify these distinctions.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"PnmgxiJdAe"}],"key":"Vx0k1dx0Lt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"h_li_sigma : the estimated error in the surface-height estimate","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"jLFWwfjmXp"}],"key":"twPejluLoW"}],"key":"wp9AzHfGHh"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"n_fit_photons : The number of photons found in each segment","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"SFv6QKiXHO"}],"key":"L5n4pJkZ1n"}],"key":"JJlnaqnmFl"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"w_surface_window_final : The size of the converged surface window","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"CvfjAMCWf2"}],"key":"mrG80B8JNx"}],"key":"ra6vPlDRud"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"h_robust_sprd : A percentile-based estimate of the spread of the photons, corrected for background","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"jVeYacvpXK"}],"key":"zsx5pbeuO8"}],"key":"R29j2rkcDZ"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"snr : the observed signal-to-noise ratio for the selected photons","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"xJfjBTLs2z"}],"key":"zcUKA8Efro"}],"key":"j8RF3mP5Zc"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"snr_significance : The estimated probability that a random clustering of photons would produce the observed SNR","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"QlE5coyW5m"}],"key":"HIz9BWZxFx"}],"key":"iekVQu1y2Y"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"dh_fit_dx : the along-track segment slope","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"IZKGstL17q"}],"key":"UIEyySR88S"}],"key":"MPvwoHY2j3"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"r_eff : the effective reflectance of the surface","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"wjVnWvrpGM"}],"key":"vKovhbKrDy"}],"key":"r2D26HrsrB"}],"key":"FzDizyqmtQ"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"There’s one more parameter that puts a few of these ideas together, in /gtxx/land_ice_segments:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"nRsYKDMTBJ"}],"key":"brpLQHDmcO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"atl06_quality_summary : a combination of parameters (h_li_sigma, n_fit_photons/w_surface_window_final, and signal_selection_source).  Zero indicates a good segment, 1 indicates a possibly bad segment.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"thIHf7MweU"}],"key":"afFqjWX62N"}],"key":"zN9HRstOHB"}],"key":"Z4kg5rMvzD"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"For most purposes selecting those points for which atl06_quality_summary==0 will filter out most of the bad returns.  Let’s regenerate the map of Cook ice shelf to see how this works:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"yhMejtRgu9"}],"key":"JjMF28Naz2"}],"key":"rEbs7l9L9B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure()\nax_scat_clean = plt.gca()\nplt.imshow(shaded_relief_img['data'], extent=shaded_relief_img['extent'])\n\nxx=np.array(D6.geometry.x)\nyy=np.array(D6.geometry.y)\nhh = np.array(D6.h_li)\nqq = np.array(D6.atl06_quality_summary)\n\n# sort the data by abs(height) to make the outliers show up\nii=np.argsort(np.abs(hh))\n# here is where we filter out the atl06_quality_summary==1 points\nii=ii[np.isfinite(hh[ii]) & (qq[ii]==0)]\nh_scat_clean=plt.scatter(xx[ii], yy[ii], 3,  c=hh[ii], clim=[-200, 200], cmap='RdBu')\nplt.colorbar(h_scat_clean, label='h_li', extend='both')\n","key":"r7kfM42ao0"},{"type":"output","id":"SjQA9llc_aAIOEhLu69q6","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"dff6037cd0e526664dcd792de707cc8f","path":"/icesat2-cookbook/_preview/26/build/dff6037cd0e526664dcd792de707cc8f.png"},"text/html":{"content_type":"text/html","hash":"58d74b1125fd4b05def33b6892f3900e","path":"/icesat2-cookbook/_preview/26/build/58d74b1125fd4b05def33b6892f3900e.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"29fe1a4b43ea4e489c6cca2d2ae758d3\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"VyCseoMTS9"}],"key":"qMRHaZRnwK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Presto!  all of the too-high and too-low returns from the first map are gone!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yBLL2uiqXf"}],"key":"vfKGdawJav"}],"key":"SaNHvV9E3s"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZHaeu7luNX"}],"key":"BqSv7vs7Sg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DN8NnAGbFs"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"KFdNO79rIw"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We have taken a look at a location in Antarctica where ICESat-2 has (mostly) successfully measured surface elevations over an ice shelf.  The default code in the cells shows an example for one track, but by switching the ‘interactive’ variable above, you should be able to find different kinds features in the data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Wf32QGvFTf"}],"key":"E9Dqz9dUiq"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"If you have time, take a few minutes to go back to the first cell after ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kejzMvxjLn"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Getting ATL03 data for a problematic track","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OUXFeqX3Fu"}],"key":"Ovr2QWyvPy"},{"type":"text","value":" and set ‘interactive’ to True. Then you can try zooming in on the map to identify the different tracks, and downloading the ATL03 to go with them (see the cell marked “select your track here”). You should be able to find:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Gh69qB8bDN"}],"key":"a5dcI61T6N"},{"type":"code","lang":"","value":"* Clouds\n* Crevasses\n* Rifts in the ice shelf\n* Sea ice or open water.","position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"key":"F7J1qt7jgs"}],"key":"VsfMTLGuSa"}],"key":"F6cHYXjgCd"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"DRAFT: Data Access","url":"/notebooks/data-access","group":"Foundations"},"next":{"title":"Geospatial Transforms","url":"/notebooks/geospatial-transforms","group":"Foundations"}}},"domain":"http://localhost:3000"}